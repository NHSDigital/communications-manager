<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
 This policy raises a 408 error response for a request timeout.

 This indicated that the server response timed out and therefore is being mapped to a 504 to show it was a problem server side.

 Raisefault policies stop the execution of the current flow and move to the error flow, which returns the error response defined here to the requesting application.

 For more information on RaiseFault policies within Apigee see the following resource:
    * https://docs.apigee.com/api-platform/reference/policies/raise-fault-policy
-->
<RaiseFault async="false" continueOnError="false" enabled="true" name="RaiseFault.408ServerRequestTimeout">
    <DisplayName>RaiseFault.408ServerRequestTimeout</DisplayName>
    <Properties/>
    <FaultResponse>
        <Set>
            <Headers/>
            <StatusCode>504</StatusCode>
            <ReasonPhrase>Request Timeout</ReasonPhrase>
            <Payload variablePrefix="@" variableSuffix="#">
                {
                    "errors" : [
                        {
                            "id" : "@messageid#.0",
                            "code" : "CM_TIMEOUT",
                            "links" : {
                                "about" : "{{ ERROR_ABOUT_LINK }}"
                            },
                            "status" : "504",
                            "title" : "Request timeout",
                            "detail" : "The service was unable to receive your request within the timeout period."
                        }
                    ]
                }
            </Payload>
        </Set>
    </FaultResponse>
    <IgnoreUnresolvedVariables>false</IgnoreUnresolvedVariables>
</RaiseFault>
